# ============================================
# SciTeX: Python Framework for Scientific Research
# https://scitex.ai
# ============================================

# /home/ywatanabe/proj/scitex-code/pyproject.toml

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "scitex"
version = "2.7.3"
description = "A comprehensive Python library for scientific computing and data analysis"
readme = "README.md"
requires-python = ">=3.8"
license = { text = "MIT" }
authors = [
    { name = "Yusuke Watanabe", email = "ywatanabe@scitex.ai" }
]
keywords = [
    "scientific-computing",
    "data-analysis",
    "machine-learning",
    "signal-processing",
    "neural-networks",
    "research"
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Science/Research",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Scientific/Engineering",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "Topic :: Scientific/Engineering :: Information Analysis",
    "Topic :: Software Development :: Libraries :: Python Modules",
]

# ============================================
# Core Dependencies (Always Installed)
# ============================================
dependencies = [
    # Scientific Computing
    "numpy",
    "scipy",
    "pandas",
    "matplotlib",
    "seaborn",
    "plotly",
    # Machine Learning (Basic)
    "scikit-learn",
    "statsmodels",
    # File Formats & Data Processing
    "h5py",
    "openpyxl",
    "xlrd",
    "PyYAML",
    "ruamel.yaml",
    "lxml",
    "lxml_html_clean",
    "xarray",
    "zarr",
    "numcodecs",
    # Image Processing
    "Pillow",
    "piexif",  # For JPEG EXIF metadata
    "pypdf",  # For PDF metadata embedding (Nature Reviews compliance)
    "qrcode[pil]",  # For QR code generation
    # Utilities
    "requests",
    "aiohttp",
    "joblib",
    "psutil",
    "packaging",
    "more-itertools",
    "natsort",
    "tabulate",
    # Interactive Python
    "ipython",
    "tqdm",
    # Version Control
    "GitPython",
    # CLI
    "click",
    # Extras
    "nest-asyncio",
    "google-search-results",
    "googlesearch-python",
    "sqlalchemy",
    "psycopg2-binary",
    "Pyarrow",
    "xmltodict",
    "sounddevice",
    "joypy",
    "julius",
    "pebble",
    "impact-factor",
    "tk",
    "icecream",
    "pyperclip",
    "readchar",
    "plyer",
    "timeout-decorator",
    "ansi-escapes",
    "chardet",
    "termplotlib",
    "tldr",
    "attrdict",
    "reportlab",
    "readability",
    "readability-lxml",
    "python-magic",
    "thefuzz",
    "pyautogui",
    "webrequests",
    "sql_manager",
    "pymatreader",
    "six",
]

[project.urls]
Homepage = "https://github.com/ywatanabe1989/scitex-code"
Documentation = "https://scitex.readthedocs.io"
Repository = "https://github.com/ywatanabe1989/scitex-code"
"Bug Tracker" = "https://github.com/ywatanabe1989/scitex-code/issues"

[project.scripts]
scitex = "scitex.__main__:main"

# ============================================
# Optional Dependencies
# ============================================

[project.optional-dependencies]

# Deep Learning (Heavy - 2-4 GB)
dl = [
    "torch",
    "torchvision",
    "torchaudio",
    "torchsummary",
    "transformers",
    "accelerate",
    "bitsandbytes",
    "fairscale",
    "pytorch_pretrained_vit",
    "pytorch-optimizer",
    "einops",
]

# Additional Machine Learning Tools
ml = [
    "scikit-image",
    "imbalanced-learn",
    "umap-learn",
    "sktime",
    "catboost",
    "optuna",
    "sympy",
    "opencv-python",
    "openai",
    "anthropic",
    "google-genai",
    "groq",
    "llama-stack",
    "elevenlabs",
]
# Jupyter & Interactive Development
jupyter = [
    "jupyterlab",
    "jupyter-collaboration",
    "ipykernel",
    "ipdb",
    "papermill",
    "jupytext",
    "nbsphinx",
]

# Neuroscience & Specialized Scientific
neuro = [
    "mne",
    "obspy",
    "pyedflib",
    "pybids",
    "tensorpac",
    "ripple_detection",
    "geom_median",
]

# Web Frameworks
web = [
    "fastapi",
    "flask",
    "streamlit",
    "celery",
]

# GUI Editors (stx.vis.edit)
gui = [
    "flask",           # Web editor backend
    "dearpygui",       # GPU-accelerated desktop editor
    "PyQt6",           # Qt desktop editor (alternative: PyQt5, PySide6, PySide2)
]

# Audio/TTS Module
audio = [
    "pyttsx3",         # System TTS (offline, free)
    "gTTS",            # Google TTS (free, requires internet)
    "pydub",           # Audio manipulation (speed control)
    "elevenlabs",      # ElevenLabs (paid, high quality)
    "mcp",             # MCP server integration
]

# MS Word Import/Export Module
msword = [
    "python-docx",     # MS Word document manipulation
    "pypandoc",        # Pandoc integration for conversions
]

# Scholar Module - Paper Management & Browser
scholar = [
    "selenium",
    "webdriver-manager",
    "bs4",
    "html2text",
    "crawl4ai",
    "scholarly",
    "pymed",
    "python-docx",
    "PyPDF2",
    "pdfplumber",
    "PyMuPDF",
    "pytesseract",
    "bibtexparser",
    "playwright>=1.40.0",
    "feedparser",
    "httpx",
    "tenacity",
    "pydantic",
    "watchdog",
    "natsort",
]

# Writer Module - Academic Paper Writing & LaTeX Compilation
writer = [
    "yq",  # YAML query tool for compilation script configuration
    "xlsx2csv",
    "csv2latex",
]

# Development Tools
dev = [
    # Testing
    "pytest",
    "pytest-cov",
    "pytest-xdist",
    "pytest-timeout",
    "pytest-mock",
    "pytest-env",
    "pytest-asyncio",
    "pytest-testmon",
    # Code Quality & Formatting
    "ruff",          # Primary linter and formatter (replaces black, isort, flake8)
    "mypy",
    "pre-commit",
    "pyright",
    "python-lsp-server",
    "jedi",
    "rope",
    # Profiling & Performance
    "line-profiler",
    "memory-profiler",
    # Documentation
    "sphinx",
    "sphinx-rtd-theme",
    "sphinx-autodoc-typehints",
    "sphinx-autobuild",
    "myst-parser",
    "markdown",
    "markdown2",
    "pygments",
    # Build & Distribution
    "build",
    "twine",
    "wheel",
    "setuptools",
    # Type Hints
    "types-requests",
    "types-PyYAML",
    "types-setuptools",
]

# All features except dev
all = [
    # dl
    "torch",
    "torchvision",
    "torchaudio",
    "torchsummary",
    "transformers",
    "accelerate",
    "bitsandbytes",
    "fairscale",
    "pytorch_pretrained_vit",
    "pytorch-optimizer",
    "einops",
    # ml
    "scikit-image",
    "imbalanced-learn",
    "umap-learn",
    "sktime",
    "catboost",
    "optuna",
    "sympy",
    "opencv-python",
    "openai",
    "anthropic",
    "google-genai",
    "groq",
    "llama-stack",    
    # neuro
    "mne",
    "obspy",
    "pyedflib",
    "pybids",
    "tensorpac",
    "ripple_detection",
    "geom_median",
    # scholar
    "selenium",
    "webdriver-manager",
    "bs4",
    "html2text",
    "crawl4ai",
    "scholarly",
    "pymed",
    "python-docx",
    "PyPDF2",
    "pdfplumber",
    "PyMuPDF",
    "pytesseract",
    "bibtexparser",
    "playwright>=1.40.0",
    "feedparser",
    "httpx",
    "tenacity",
    "pydantic",
    "watchdog",
    # web
    "fastapi",
    "flask",
    "streamlit",
    # gui
    "dearpygui",
    "PyQt6",
    # writer
    "yq",
    # jupyter
    "jupyterlab",
    "jupyter-collaboration",
    "ipykernel",
    "ipdb",
    "papermill",
    "jupytext",
    "nbsphinx",
]

# ============================================
# Tool Configurations
# ============================================

[tool.hatch.version]
path = "src/scitex/__version__.py"
pattern = '__version__ = "(?P<version>[^"]+)"'

[tool.hatch.build.targets.wheel]
exclude = [
    "src/scitex/scholar/crossref_local",
]

[tool.hatch.build.targets.sdist]
exclude = [
    "src/scitex/scholar/crossref_local",
]

[tool.pytest.ini_options]
minversion = "6.0"
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "-v",
    "--tb=short",
    "--strict-markers",
    "--disable-warnings",
    "-p", "no:warnings",
    "--ignore=tests/custom/old/",
]
asyncio_mode = "auto"
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests",
    "asyncio: marks tests as async tests",
    "benchmark: marks tests as benchmark tests",
    "filterwarnings: marks tests to filter specific warnings",
]
filterwarnings = [
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning",
    "ignore::FutureWarning",
]

[tool.coverage.run]
source = ["src/scitex"]
branch = true
parallel = true
omit = [
    "*/tests/*",
    "*/__pycache__/*",
    "*/.old/*",
    "*/migrations/*",
    "*/conftest.py",
    "*/setup.py",
    "*/__main__.py",
    "*/versioneer.py",
    "*/_version.py",
]

[tool.coverage.report]
precision = 2
show_missing = true
skip_covered = false
sort = "Cover"
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "def __str__",
    "if TYPE_CHECKING:",
    "if typing.TYPE_CHECKING:",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if __name__ == .__main__.",
    "pass",
    "except ImportError:",
    "except ModuleNotFoundError:",
    "warnings.warn",
    "logger.debug",
    "logger.info",
]

[tool.coverage.paths]
source = [
    "src/scitex",
    "*/site-packages/scitex",
]

[tool.coverage.html]
directory = "htmlcov"
title = "SciTeX Coverage Report"
skip_covered = false
skip_empty = true

[tool.isort]
profile = "black"
line_length = 88
known_first_party = ["scitex"]
known_third_party = ["numpy", "pandas", "matplotlib", "scipy", "sklearn", "torch", "pytest"]
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
skip_glob = ["*/.old/*", "*/migrations/*", "*/__pycache__/*"]

[tool.black]
line-length = 88
target-version = ["py38", "py39", "py310", "py311", "py312"]
include = '\.pyi?$'

[tool.flake8]
max-line-length = 88
extend-ignore = ["E203", "E266", "E501", "W503", "E731", "E402"]
max-complexity = 10
exclude = [
    ".git",
    "__pycache__",
    "docs/source/conf.py",
    "old",
    "build",
    "dist",
    ".eggs",
    "*.egg",
    ".tox",
    ".coverage",
    ".coveragerc",
    "htmlcov",
    ".pytest_cache",
    ".mypy_cache",
    "migrations",
]
per-file-ignores = [
    "__init__.py:F401,F403",
    "tests/*:F401,F403,F811",
]

[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = false
disallow_incomplete_defs = false
check_untyped_defs = true
disallow_untyped_decorators = false
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true
strict_optional = true
ignore_missing_imports = true
implicit_reexport = true
namespace_packages = true
show_error_codes = true
show_column_numbers = true
pretty = true

[[tool.mypy.overrides]]
module = "tests.*"
ignore_errors = true

[[tool.mypy.overrides]]
module = "setup"
ignore_errors = true

# ============================================
# Ruff Configuration
# ============================================

[tool.ruff]
target-version = "py38"
line-length = 88
exclude = [
    ".git",
    ".ruff_cache",
    ".mypy_cache",
    ".pytest_cache",
    "__pycache__",
    "build",
    "dist",
    ".eggs",
    "*.egg",
    ".old*",
    "migrations",
    "htmlcov",
    "docs/to_claude",
    "src/scitex/scholar/docs",
    "examples/*/docs",
]

[tool.ruff.lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # Pyflakes
    "I",      # isort
    "B",      # flake8-bugbear
    "C4",     # flake8-comprehensions
    "UP",     # pyupgrade
]
ignore = [
    "E203",   # whitespace before ':'
    "E266",   # too many leading '#' for block comment
    "E501",   # line too long (handled by formatter)
    "E731",   # do not assign a lambda expression
    "E402",   # module level import not at top of file
    "B008",   # do not perform function calls in argument defaults
    "B905",   # zip() without an explicit strict= parameter
]

[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["F401", "F403"]
"tests/*" = ["F401", "F403", "F811"]

[tool.ruff.lint.isort]
known-first-party = ["scitex"]
known-third-party = ["numpy", "pandas", "matplotlib", "scipy", "sklearn", "torch", "pytest"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"