{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://scitex.ai/schemas/fts/stats.schema.json",
  "title": "FTS Stats Schema",
  "description": "Schema for statistical analysis results with full reproducibility",
  "type": "object",
  "properties": {
    "analyses": {
      "type": "array",
      "description": "List of statistical analyses",
      "items": {
        "type": "object",
        "required": ["result_id", "method", "inputs", "results"],
        "properties": {
          "result_id": {
            "type": "string",
            "description": "Unique identifier for referencing this result"
          },
          "method": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Statistical test name (e.g., 't-test', 'ANOVA', 'Mann-Whitney')"
              },
              "variant": {
                "type": "string",
                "description": "Specific variant (e.g., 'paired', 'independent', 'one-way')"
              },
              "parameters": {
                "type": "object",
                "description": "Test-specific parameters"
              },
              "correction": {
                "type": "object",
                "description": "Multiple comparison correction",
                "properties": {
                  "method": {"type": "string", "enum": ["none", "bonferroni", "holm", "fdr_bh", "fdr_by"]},
                  "n_comparisons": {"type": "integer", "minimum": 1}
                }
              }
            }
          },
          "inputs": {
            "type": "object",
            "description": "Input data references for reproducibility",
            "properties": {
              "data_refs": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": {"type": "string"},
                    "sha256": {"type": "string", "pattern": "^[a-f0-9]{64}$"},
                    "columns": {"type": "array", "items": {"type": "string"}},
                    "filter": {"type": "string", "description": "Filter expression applied"}
                  }
                }
              },
              "groups": {
                "type": "array",
                "items": {"type": "string"}
              },
              "n_per_group": {
                "type": "array",
                "items": {"type": "integer", "minimum": 0}
              }
            }
          },
          "results": {
            "type": "object",
            "properties": {
              "statistic": {"type": "number"},
              "statistic_name": {"type": "string", "description": "e.g., 't', 'F', 'U', 'chi2'"},
              "p_value": {"type": "number", "minimum": 0, "maximum": 1},
              "p_corrected": {"type": "number", "minimum": 0, "maximum": 1},
              "df": {"type": ["number", "array"], "description": "Degrees of freedom"},
              "effect_size": {
                "type": "object",
                "properties": {
                  "name": {"type": "string", "description": "e.g., 'cohens_d', 'eta_squared', 'r'"},
                  "value": {"type": "number"},
                  "ci_lower": {"type": "number"},
                  "ci_upper": {"type": "number"}
                }
              },
              "ci": {
                "type": "object",
                "description": "Confidence interval for difference",
                "properties": {
                  "level": {"type": "number", "default": 0.95},
                  "lower": {"type": "number"},
                  "upper": {"type": "number"}
                }
              },
              "power": {"type": "number", "minimum": 0, "maximum": 1}
            }
          },
          "display": {
            "type": "object",
            "description": "How to display this result in the figure",
            "properties": {
              "significance_label": {
                "type": "string",
                "description": "e.g., '***', 'n.s.', 'p < 0.001'"
              },
              "bracket": {
                "type": "object",
                "properties": {
                  "start": {"type": "string", "description": "Element ID or position"},
                  "end": {"type": "string"}
                }
              }
            }
          },
          "created_at": {"type": "string", "format": "date-time"}
        }
      }
    },
    "software": {
      "type": "object",
      "description": "Software versions for reproducibility",
      "properties": {
        "python": {"type": "string"},
        "scipy": {"type": "string"},
        "statsmodels": {"type": "string"},
        "fsb": {"type": "string"}
      }
    }
  }
}
