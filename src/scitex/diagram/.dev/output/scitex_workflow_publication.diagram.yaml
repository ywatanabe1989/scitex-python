# SciTeX Figure Workflow - PUBLICATION MODE
# Optimized for minimal whitespace in paper figures

type: workflow
title: SciTeX Figure Lifecycle

paper:
  column: single
  max_width_mm: 170
  reading_direction: left_to_right
  mode: publication          # KEY: Compact layout, hidden return edges
  emphasize:
    - figz_bundle
    - editor
    - ai_review
  # Return edges to hide in publication (source, target)
  return_edges:
    - [editor, figz_bundle]
    - [ai_review, figz_bundle]

layout:
  layer_gap: tight           # Minimal spacing
  node_gap: tight
  # CRITICAL: Explicit layer assignment for rank=same
  layers:
    - [python_code, savefig]           # Layer 1: Creation
    - [figz_bundle]                     # Layer 2: Central bundle
    - [spec_json, data_csv, preview]    # Layer 3: Bundle contents
    - [editor, ai_review]               # Layer 4: Editing tools
    - [export]                          # Layer 5: Output

nodes:
  - id: python_code
    label: Python
    shape: rounded
    emphasis: normal

  - id: savefig
    label: savefig()
    shape: box
    emphasis: normal

  - id: figz_bundle
    label: .figz
    shape: stadium
    emphasis: primary

  - id: spec_json
    label: spec
    shape: box
    emphasis: normal

  - id: data_csv
    label: data
    shape: box
    emphasis: normal

  - id: preview
    label: preview
    shape: box
    emphasis: muted

  - id: editor
    label: Editor
    shape: rounded
    emphasis: primary

  - id: ai_review
    label: AI
    shape: diamond
    emphasis: primary

  - id: export
    label: Export
    shape: stadium
    emphasis: success

edges:
  # Main flow
  - from: python_code
    to: savefig

  - from: savefig
    to: figz_bundle

  # Bundle contents (dashed = derived)
  - from: figz_bundle
    to: spec_json
    style: dashed

  - from: figz_bundle
    to: data_csv
    style: dashed

  - from: figz_bundle
    to: preview
    style: dashed

  # Editing flow
  - from: figz_bundle
    to: editor

  - from: editor
    to: figz_bundle
    label: changes

  - from: figz_bundle
    to: ai_review

  - from: ai_review
    to: figz_bundle
    label: diffs

  # Output
  - from: figz_bundle
    to: export
